const input_img=document.querySelector("#publicacao_img"),input_categoria=document.querySelector("#input_categoria"),t_field_legenda=document.querySelector("#t_field_legenda"),t_field_receita=document.querySelector("#t_field_receita"),btn_publicar=document.querySelector("#btn_publicar"),form_publicar=document.querySelector("#form_publicar"),text_validacao=document.querySelector("#text_validacao"),categoriaOptions=Array.from(document.querySelectorAll("#categoria-list option")).map((e=>e.value)),API_URL_POSTAGEM="http://127.0.0.1:5000/postagem";function verificarTamanhoImagem(e){return e.size<=31457280}function verificarProporcaoImagem(e){return new Promise(((a,t)=>{const o=new Image;o.src=URL.createObjectURL(e),o.onload=()=>{a(o.width<=1080&&o.height<=1080)},o.onerror=()=>t(new Error("Erro ao carregar a imagem."))}))}form_publicar.addEventListener("submit",(async e=>{if(e.preventDefault(),!input_categoria.value)return text_validacao.innerText="Por favor, selecione uma categoria.",void(text_validacao.style.display="block");if(!categoriaOptions.includes(input_categoria.value))return text_validacao.innerText="Por favor, selecione uma categoria válida.",void(text_validacao.style.display="block");if(!input_img.files.length)return text_validacao.innerText="Por favor, selecione uma imagem.",void(text_validacao.style.display="block");const a=input_img.files[0];if(!verificarTamanhoImagem(a))return text_validacao.innerText="A imagem não pode ter mais de 30 MB.",void(text_validacao.style.display="block");try{if(!await verificarProporcaoImagem(a))return text_validacao.innerText="A imagem não pode ter uma proporção maior que 1080 x 1080 pixels.",void(text_validacao.style.display="block")}catch(e){return console.error(e),text_validacao.innerText="Erro ao verificar a proporção da imagem.",void(text_validacao.style.display="block")}btn_publicar.disabled=!0,btn_publicar.innerText="Publicando...";const t=new FormData;t.append("usuario",JSON.parse(sessionStorage.getItem("usuario"))),t.append("categoria",input_categoria.value),t.append("img",a),t.append("receita",t_field_receita.value),await fetch(API_URL_POSTAGEM,{method:"POST",body:t,mode:"cors"}).catch((e=>console.error("Erro:",e))),window.location.reload()}));